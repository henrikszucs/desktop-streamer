"use strict";var require$$0$1=require("fs"),require$$1=require("path"),require$$0=require("util"),require$$2=require("child_process"),require$$0$2=require("os");function getDefaultExportFromCjs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var pathIsAbsolute={exports:{}};function posix(t){return"/"===t.charAt(0)}function win32(t){var e=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/.exec(t),i=e[1]||"",n=Boolean(i&&":"!==i.charAt(1));return Boolean(e[2]||n)}pathIsAbsolute.exports="win32"===process.platform?win32:posix,pathIsAbsolute.exports.posix=posix,pathIsAbsolute.exports.win32=win32;var pathIsAbsoluteExports=pathIsAbsolute.exports;function requireRegistry(){if(hasRequiredRegistry)return registry;hasRequiredRegistry=1;var t=require$$0,e=require$$1,i=require$$2.spawn,n="HKLM",r="HKCU",s="HKCR",a="HKCC",u=[n,r,s,"HKU",a],o="REG_SZ",c="REG_MULTI_SZ",l="REG_EXPAND_SZ",h="REG_DWORD",p="REG_QWORD",f="REG_BINARY",d="REG_NONE",v=[o,c,l,h,p,f,d],y=/(\\[a-zA-Z0-9_\s]+)*/,m=/^(HKEY_LOCAL_MACHINE|HKEY_CURRENT_USER|HKEY_CLASSES_ROOT|HKEY_USERS|HKEY_CURRENT_CONFIG)(.*)$/,g=/^(.*)\s(REG_SZ|REG_MULTI_SZ|REG_EXPAND_SZ|REG_DWORD|REG_QWORD|REG_BINARY|REG_NONE)\s+([^\s].*)$/;function E(t,e){if(!(this instanceof E))return new E(t,e);Error.captureStackTrace(this,E),this.__defineGetter__("name",function(){return E.name}),this.__defineGetter__("message",function(){return t}),this.__defineGetter__("code",function(){return e})}function x(t){var e={stdout:"",stderr:""};return t.stdout.on("data",function(t){e.stdout+=t.toString()}),t.stderr.on("data",function(t){e.stderr+=t.toString()}),e}function A(e,i,n){var r=n.stdout.trim(),s=n.stderr.trim(),a=t.format("%s command exited with code %d:\n%s\n%s",e,i,r,s);return new E(a,i)}function R(t,e){e&&t.push("/reg:"+function t(e){if("x64"==e)return"64";if("x86"==e)return"32";throw Error("illegal architecture: "+e+" (use x86 or x64)")}(e))}function w(){return"win32"===process.platform?e.join(process.env.windir,"system32","reg.exe"):"REG"}function b(t,e,i,n,r,s,a){if(!(this instanceof b))return new b(t,e,i,n,r,s,a);var u=t,o=e,c=i,l=n,h=r,p=s,f=a;this.__defineGetter__("host",function(){return u}),this.__defineGetter__("hive",function(){return o}),this.__defineGetter__("key",function(){return c}),this.__defineGetter__("name",function(){return l}),this.__defineGetter__("type",function(){return h}),this.__defineGetter__("value",function(){return p}),this.__defineGetter__("arch",function(){return f})}function P(t){if(!(this instanceof P))return new P(t);var e=t||{},i=""+(e.host||""),r=""+(e.hive||n),s=""+(e.key||""),a=e.arch||null;if(this.__defineGetter__("host",function(){return i}),this.__defineGetter__("hive",function(){return r}),this.__defineGetter__("key",function(){return s}),this.__defineGetter__("path",function(){return(0==i.length?"":"\\\\"+i+"\\")+r+s}),this.__defineGetter__("arch",function(){return a}),this.__defineGetter__("parent",function(){var t=s.lastIndexOf("\\");return new P({host:this.host,hive:this.hive,key:-1==t?"":s.substring(0,t),arch:this.arch})}),-1==u.indexOf(r))throw Error("illegal hive specified.");if(!y.test(s))throw Error("illegal key specified.");if(a&&"x64"!=a&&"x86"!=a)throw Error("illegal architecture specified (use x86 or x64)")}return t.inherits(E,Error),t.inherits(b,Object),P.HKLM=n,P.HKCU=r,P.HKCR=s,P.HKU="HKU",P.HKCC=a,P.HIVES=u,P.REG_SZ=o,P.REG_MULTI_SZ=c,P.REG_EXPAND_SZ=l,P.REG_DWORD=h,P.REG_QWORD=p,P.REG_BINARY=f,P.REG_NONE=d,P.REG_TYPES=v,P.DEFAULT_VALUE="",P.prototype.values=function t(e){if("function"!=typeof e)throw TypeError("must specify a callback");var n=["QUERY",this.path];R(n,this.arch);var r=i(w(),n,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),s="",a=this,u=null,o=x(r);return r.on("close",function(t){if(!u){if(0!==t)e(A("QUERY",t,o),null);else{for(var i=[],n=[],r=s.split("\n"),c=0,l=0,h=r.length;l<h;l++){var p=r[l].trim();p.length>0&&(0!=c&&i.push(p),++c)}for(var l=0,h=i.length;l<h;l++){var f,d,v,y=g.exec(i[l]);y&&(f=y[1].trim(),d=y[2].trim(),v=y[3],n.push(new b(a.host,a.hive,a.key,f,d,v,a.arch)))}e(null,n)}}}),r.stdout.on("data",function(t){s+=t.toString()}),r.on("error",function(t){u=t,e(t)}),this},P.prototype.keys=function t(e){if("function"!=typeof e)throw TypeError("must specify a callback");var n=["QUERY",this.path];R(n,this.arch);var r=i(w(),n,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),s="",a=this,u=null,o=x(r);return r.on("close",function(t){!u&&0!==t&&e(A("QUERY",t,o),null)}),r.stdout.on("data",function(t){s+=t.toString()}),r.stdout.on("end",function(){for(var t=[],i=[],n=s.split("\n"),r=0,u=n.length;r<u;r++){var o=n[r].trim();o.length>0&&t.push(o)}for(var r=0,u=t.length;r<u;r++){var c,l=m.exec(t[r]);l&&(l[1],(c=l[2])&&c!==a.key&&i.push(new P({host:a.host,hive:a.hive,key:c,arch:a.arch})))}e(null,i)}),r.on("error",function(t){u=t,e(t)}),this},P.prototype.get=function t(e,n){if("function"!=typeof n)throw TypeError("must specify a callback");var r=["QUERY",this.path];""==e?r.push("/ve"):r=r.concat(["/v",e]),R(r,this.arch);var s=i(w(),r,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),a="",u=this,o=null,c=x(s);return s.on("close",function(t){if(!o){if(0!==t)n(A("QUERY",t,c),null);else{for(var e=[],i=null,r=a.split("\n"),s=0,l=0,h=r.length;l<h;l++){var p=r[l].trim();p.length>0&&(0!=s&&e.push(p),++s)}var f,d,v,y=e[e.length-1]||"",m=g.exec(y);m&&(f=m[1].trim(),d=m[2].trim(),v=m[3],i=new b(u.host,u.hive,u.key,f,d,v,u.arch)),n(null,i)}}}),s.stdout.on("data",function(t){a+=t.toString()}),s.on("error",function(t){o=t,n(t)}),this},P.prototype.set=function t(e,n,r,s){if("function"!=typeof s)throw TypeError("must specify a callback");if(-1==v.indexOf(n))throw Error("illegal type specified.");var a=["ADD",this.path];""==e?a.push("/ve"):a=a.concat(["/v",e]),R(a=a.concat(["/t",n,"/d",r,"/f"]),this.arch);var u=i(w(),a,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),o=null,c=x(u);return u.on("close",function(t){!o&&(0!==t?s(A("ADD",t,c)):s(null))}),u.stdout.on("data",function(t){}),u.on("error",function(t){o=t,s(t)}),this},P.prototype.remove=function t(e,n){if("function"!=typeof n)throw TypeError("must specify a callback");var r=e?["DELETE",this.path,"/f","/v",e]:["DELETE",this.path,"/f","/ve"];R(r,this.arch);var s=i(w(),r,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),a=null,u=x(s);return s.on("close",function(t){!a&&(0!==t?n(A("DELETE",t,u),null):n(null))}),s.stdout.on("data",function(t){}),s.on("error",function(t){a=t,n(t)}),this},P.prototype.clear=function t(e){if("function"!=typeof e)throw TypeError("must specify a callback");var n=["DELETE",this.path,"/f","/va"];R(n,this.arch);var r=i(w(),n,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),s=null,a=x(r);return r.on("close",function(t){!s&&(0!==t?e(A("DELETE",t,a),null):e(null))}),r.stdout.on("data",function(t){}),r.on("error",function(t){s=t,e(t)}),this},P.prototype.erase=P.prototype.clear,P.prototype.destroy=function t(e){if("function"!=typeof e)throw TypeError("must specify a callback");var n=["DELETE",this.path,"/f"];R(n,this.arch);var r=i(w(),n,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),s=null,a=x(r);return r.on("close",function(t){!s&&(0!==t?e(A("DELETE",t,a),null):e(null))}),r.stdout.on("data",function(t){}),r.on("error",function(t){s=t,e(t)}),this},P.prototype.create=function t(e){if("function"!=typeof e)throw TypeError("must specify a callback");var n=["ADD",this.path,"/f"];R(n,this.arch);var r=i(w(),n,{cwd:void 0,env:process.env,stdio:["ignore","pipe","pipe"]}),s=null,a=x(r);return r.on("close",function(t){!s&&(0!==t?e(A("ADD",t,a),null):e(null))}),r.stdout.on("data",function(t){}),r.on("error",function(t){s=t,e(t)}),this},P.prototype.keyExists=function t(e){return this.values(function(t,i){if(t)return 1==t.code?e(null,!1):e(t);e(null,!0)}),this},P.prototype.valueExists=function t(e,i){return this.get(e,function(t,e){if(t)return 1==t.code?i(null,!1):i(t);i(null,!0)}),this},registry=P}function requireAutoLaunchWindows(){var t,e,i,n;return hasRequiredAutoLaunchWindows?AutoLaunchWindows:(hasRequiredAutoLaunchWindows=1,e=require$$0$1,i=require$$1,n=new(t=requireRegistry())({hive:t.HKCU,key:"\\Software\\Microsoft\\Windows\\CurrentVersion\\Run"}),AutoLaunchWindows={enable:function(r){var s,a,u;return s=r.appName,a=r.appPath,u=r.isHiddenOnLaunch,new Promise(function(r,o){var c,l,h,p;return l=a,c="",p=i.join(i.dirname(process.execPath),"..","update.exe"),(null!=(h=process.versions)?h.electron:void 0)!=null&&e.existsSync(p)?(l=p,c=' --processStart "'+i.basename(process.execPath)+'"',u&&(c+=' --process-start-args "--hidden"')):u&&(c+=" --hidden"),n.set(s,t.REG_SZ,'"'+l+'"'+c,function(t){return null!=t?o(t):r()})})},disable:function(t){return new Promise(function(e,i){return n.remove(t,function(t){return null!=t?-1!==t.message.indexOf("The system was unable to find the specified registry key or value")?e(!1):i(t):e()})})},isEnabled:function(t){return new Promise(function(e,i){return n.get(t,function(t,i){return null!=t?e(!1):e(null!=i)})})}})}var applescript={},applescriptParser={};function requireApplescriptParser(){return hasRequiredApplescriptParser||(hasRequiredApplescriptParser=1,!function(t){function e(){var e=this.value[this.index];switch(e){case"{":return t.ArrayParser.call(this);case'"':return t.StringParser.call(this);case"a":if("alias"==this.value.substring(this.index,this.index+5))return t.AliasParser.call(this);break;case"\xab":if("\xabdata"==this.value.substring(this.index,this.index+5))return t.DataParser.call(this)}return isNaN(e)?t.UndefinedParser.call(this):t.NumberParser.call(this)}t.parse=function(t){if(0!=t.length)return e.call({value:t,index:0})},t.AliasParser=function(){return this.index+=6,"/Volumes/"+t.StringParser.call(this).replace(/:/g,"/")},t.ArrayParser=function(){for(var t=[],i=this.value[++this.index];"}"!=i;)t.push(e.call(this)),","==this.value[this.index]&&(this.index+=2),i=this.value[this.index];return this.index++,t},t.DataParser=function(){var e=t.UndefinedParser.call(this),i=(e=e.substring(6,e.length-1)).substring(0,4);e=e.substring(4,e.length);for(var n=new Buffer(e.length/2),r=0,s=0,a=e.length;s<a;s+=2)n[r++]=parseInt(e[s]+e[s+1],16);return n.type=i,n},t.NumberParser=function(){return Number(t.UndefinedParser.call(this))},t.StringParser=function(t){for(var e="",i=++this.index,n=this.value[i++];'"'!=n;)"\\"==n&&(e+=this.value.substring(this.index,i-1),this.index=i++),n=this.value[i++];return e+=this.value.substring(this.index,i-1),this.index=i,e};var i=/}|,|\n/;t.UndefinedParser=function(){for(var t=this.index,e=this.value[t++];!i.test(e);)e=this.value[t++];var n=this.value.substring(this.index,t-1);return this.index=t-1,n}}(applescriptParser)),applescriptParser}function requireApplescript(){return hasRequiredApplescript||(hasRequiredApplescript=1,!function(t){var e=require$$2.spawn;t.Parsers=requireApplescriptParser();var i=t.Parsers.parse;function n(n,s,a){var u=!1;Array.isArray(s)||(a=s,s=[],u=!0),s.push("-ss"),u||s.push(n);var o=e(t.osascript,s);r(o.stdout),r(o.stderr),o.on("exit",function(t){var e,r=i(o.stdout.body);t&&((e=Error(o.stderr.body)).appleScript=n,e.exitCode=t),a&&a(e,r,o.stderr.body)}),u&&(o.stdin.write(n),o.stdin.end())}function r(t){t.body="",t.setEncoding("utf8"),t.on("data",function(e){t.body+=e})}t.osascript="osascript",t.execFile=function t(e,i,r){return Array.isArray(i)||(r=i,i=[]),n(e,i,r)},t.execString=function t(e,i){return n(e,i)}}(applescript)),applescript}function requireUntildify(){if(hasRequiredUntildify)return untildify;hasRequiredUntildify=1;let t=require$$0$2.homedir();return untildify=e=>{if("string"!=typeof e)throw TypeError(`Expected a string, got ${typeof e}`);return t?e.replace(/^~(?=$|\/|\\)/,t):e}}function requireMkdirp(){if(hasRequiredMkdirp)return mkdirp;hasRequiredMkdirp=1;var t=require$$1,e=require$$0$1,i=parseInt("0777",8);function n(r,s,a,u){"function"==typeof s?(a=s,s={}):s&&"object"==typeof s||(s={mode:s});var o=s.mode,c=s.fs||e;void 0===o&&(o=i),u||(u=null);var l=a||function(){};r=t.resolve(r),c.mkdir(r,o,function(e){if(!e)return l(null,u=u||r);if("ENOENT"===e.code){if(t.dirname(r)===r)return l(e);n(t.dirname(r),s,function(t,e){t?l(t,e):n(r,s,l,e)})}else c.stat(r,function(t,i){t||!i.isDirectory()?l(e,u):l(null,u)})})}return mkdirp=n.mkdirp=n.mkdirP=n,n.sync=function n(r,s,a){s&&"object"==typeof s||(s={mode:s});var u,o=s.mode,c=s.fs||e;void 0===o&&(o=i),a||(a=null),r=t.resolve(r);try{c.mkdirSync(r,o),a=a||r}catch(l){if("ENOENT"===l.code)a=n(t.dirname(r),s,a),n(r,s,a);else{try{u=c.statSync(r)}catch(h){throw l}if(!u.isDirectory())throw l}}return a},mkdirp}function requireFileBasedUtilities(){var t,e;return hasRequiredFileBasedUtilities?fileBasedUtilities:(hasRequiredFileBasedUtilities=1,t=require$$0$1,e=requireMkdirp(),fileBasedUtilities={createFile:function(i){var n,r,s;return r=i.directory,s=i.filePath,n=i.data,new Promise(function(i,a){return e(r,function(e){return null!=e?a(e):t.writeFile(s,n,function(t){return null!=t?a(t):i()})})})},isEnabled:function(e){return new Promise(function(i,n){return t.stat(e,function(t,e){return null!=t?i(!1):i(null!=e)})})},removeFile:function(e){return new Promise(function(i,n){return t.stat(e,function(r){return null!=r?i():t.unlink(e,function(t){return null!=t?n(t):i()})})})}})}function requireAutoLaunchMac(){if(hasRequiredAutoLaunchMac)return AutoLaunchMac;hasRequiredAutoLaunchMac=1;var t,e,i,n=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return -1};return t=requireApplescript(),i=requireUntildify(),e=requireFileBasedUtilities(),AutoLaunchMac={enable:function(t){var i,n,r,s,a,u,o,c,l;return(i=t.appName,n=t.appPath,s=t.isHiddenOnLaunch,(u=t.mac).useLaunchAgent)?(o=[n],s&&o.push("--hidden"),r='<?xml version="1.0" encoding="UTF-8"?>\n<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">\n<plist version="1.0">\n<dict>\n  <key>Label</key>\n  <string>'+i+"</string>\n  <key>ProgramArguments</key>\n  <array>\n  "+(c=o.map(function(t){return"    <string>"+t+"</string>"}).join("\n"))+"\n  </array>\n  <key>RunAtLoad</key>\n  <true/>\n</dict>\n</plist>",e.createFile({data:r,directory:this.getDirectory(),filePath:this.getFilePath(i)})):(l='{path:"'+n+'", hidden:'+(a=s?"true":"false")+', name:"'+i+'"}',this.execApplescriptCommand("make login item at end with properties "+l))},disable:function(t,i){return i.useLaunchAgent?e.removeFile(this.getFilePath(t)):this.execApplescriptCommand('delete login item "'+t+'"')},isEnabled:function(t,i){return i.useLaunchAgent?e.isEnabled(this.getFilePath(t)):this.execApplescriptCommand("get the name of every login item").then(function(e){return null!=e&&n.call(e,t)>=0})},execApplescriptCommand:function(e){return new Promise(function(i,n){return t.execString('tell application "System Events" to '+e,function(t,e){return null!=t?n(t):i(e)})})},getDirectory:function(){return i("~/Library/LaunchAgents/")},getFilePath:function(t){return""+this.getDirectory()+t+".plist"}}}function requireAutoLaunchLinux(){var t,e;return hasRequiredAutoLaunchLinux?AutoLaunchLinux:(hasRequiredAutoLaunchLinux=1,e=requireUntildify(),t=requireFileBasedUtilities(),AutoLaunchLinux={enable:function(e){var i,n,r,s,a;return i=e.appName,r="[Desktop Entry]\nType=Application\nVersion=1.0\nName="+i+"\nComment="+i+"startup script\nExec="+(n=e.appPath)+(s=(a=e.isHiddenOnLaunch)?" --hidden":"")+"\nStartupNotify=false\nTerminal=false",t.createFile({data:r,directory:this.getDirectory(),filePath:this.getFilePath(i)})},disable:function(e){return t.removeFile(this.getFilePath(e))},isEnabled:function(e){return t.isEnabled(this.getFilePath(e))},getDirectory:function(){return e("~/.config/autostart/")},getFilePath:function(t){return""+this.getDirectory()+t+".desktop"}})}var registry,hasRequiredRegistry,AutoLaunchWindows,hasRequiredAutoLaunchWindows,hasRequiredApplescriptParser,hasRequiredApplescript,untildify,hasRequiredUntildify,mkdirp,hasRequiredMkdirp,fileBasedUtilities,hasRequiredFileBasedUtilities,AutoLaunchMac,hasRequiredAutoLaunchMac,AutoLaunchLinux,hasRequiredAutoLaunchLinux,isPathAbsolute,bind=function(t,e){return function(){return t.apply(e,arguments)}};isPathAbsolute=pathIsAbsoluteExports;var dist=function(){function t(t){var e,i,n,r,s;if(n=t.name,e=t.isHidden,i=t.mac,r=t.path,this.fixOpts=bind(this.fixOpts,this),this.isEnabled=bind(this.isEnabled,this),this.disable=bind(this.disable,this),this.enable=bind(this.enable,this),null==n)throw Error("You must specify a name");if(this.opts={appName:n,isHiddenOnLaunch:null!=e&&e,mac:null!=i?i:{}},s="undefined"!=typeof process&&null!==process?process.versions:void 0,null!=r){if(!isPathAbsolute(r))throw Error("path must be absolute");this.opts.appPath=r}else if(null!=s&&(null!=s.nw||null!=s["node-webkit"]||null!=s.electron))this.opts.appPath=process.execPath;else throw Error("You must give a path (this is only auto-detected for NW.js and Electron apps)");if(this.fixOpts(),this.api=null,/^win/.test(process.platform))this.api=requireAutoLaunchWindows();else if(/darwin/.test(process.platform))this.api=requireAutoLaunchMac();else if(/linux/.test(process.platform))this.api=requireAutoLaunchLinux();else throw Error("Unsupported platform")}return t.prototype.enable=function(){return this.api.enable(this.opts)},t.prototype.disable=function(){return this.api.disable(this.opts.appName,this.opts.mac)},t.prototype.isEnabled=function(){return this.api.isEnabled(this.opts.appName,this.opts.mac)},t.prototype.fixMacExecPath=function(t,e){return t=t.replace(/(^.+?[^\/]+?\.app)\/Contents\/(Frameworks\/((\1|[^\/]+?) Helper)\.app\/Contents\/MacOS\/\3|MacOS\/Electron)/,"$1"),e.useLaunchAgent||(t=t.replace(/\.app\/Contents\/MacOS\/[^\/]*$/,".app")),t},t.prototype.fixOpts=function(){var t;if(this.opts.appPath=this.opts.appPath.replace(/\/$/,""),/darwin/.test(process.platform)&&(this.opts.appPath=this.fixMacExecPath(this.opts.appPath,this.opts.mac)),-1!==this.opts.appPath.indexOf("/")?(t=this.opts.appPath.split("/"),this.opts.appName=t[t.length-1]):-1!==this.opts.appPath.indexOf("\\")&&(t=this.opts.appPath.split("\\"),this.opts.appName=t[t.length-1],this.opts.appName=this.opts.appName.substr(0,this.opts.appName.length-4)),/darwin/.test(process.platform)&&-1!==this.opts.appName.indexOf(".app",this.opts.appName.length-4))return this.opts.appName=this.opts.appName.substr(0,this.opts.appName.length-4)},t}(),index=getDefaultExportFromCjs(dist);module.exports=index;